<?xml version="1.0"?>

<!--
	Author: Slavutinsky Victor
-->

<system>

	<fileheader>
		<author> Slavutinsky Victor </author>
		<filecreationdate> 2011 </filecreationdate>
		<version>$Revision: 1.00 $</version>
		<description> Vzor </description>
	</fileheader>

<!--	That must be aded to set file

	<fdm>
		<jsbsim>
			<systems>
				<vzor>
					<serviceable type="bool">1</serviceable>
					<lock-command type="float">1</lock-command>
					<lock-pos type="float">1</lock-pos>
					<lever-command type="float">0</lever-command>
					<lever-pos type="float">0</lever-pos>
					<pilot-oscillator-pos>0</pilot-oscillator-pos>
					<shift-oscillator-command>0</shift-oscillator-command>
					<shift-oscillator-pos>0</shift-oscillator-pos>
				</vzor>
			</systems>
		</jsbsim>
	</fdm>

-->

	<channel name="Vzor">

	<!-- cover -->

		<switch name="calculations/vzor/cover-allowed">
			<default value="systems/vzor/cover-command"/>
			<test logic="AND" value="systems/vzor/cover-input">
				systems/vzor/serviceable eq 1

			</test>
			<output>systems/vzor/cover-command</output>
		</switch>

		<kinematic name="calculations/vzor/cover-pos">
			<input>systems/vzor/cover-command</input>
			<traverse>
			<setting>
				<position>0</position>
				<time>0</time>
			</setting>
			<setting>
				<position>1</position>
				<time>0.7</time>
			</setting>
			</traverse>
			<output>systems/vzor/cover-pos</output>
		</kinematic>

		<fcs_function name="calculations/vzor/petal-angle">
		<function>
			<product>
				<property>systems/vzor/cover-pos</property>
				<value>180</value>
				<value>0.475</value>
			</product>
		</function>
			<output>systems/vzor/petal-angle</output>
		</fcs_function>

		<fcs_function name="calculations/vzor/petal-angle-rad">
		<function>
			<product>
				<property>systems/vzor/cover-pos</property>
				<value>3.14159265358979323846</value>
				<value>0.475</value>
			</product>
		</function>
			<output>systems/vzor/petal-angle-rad</output>
		</fcs_function>

		<fcs_function name="calculations/vzor/petal-shift">
		<function>
			<product>
				<value>2.0</value>
				<value>0.025</value> <!-- petal length-->
				<difference>
					<value>1.0</value>
					<cos>
						<property>systems/vzor/petal-angle-rad</property>
					</cos>
				</difference>
			</product>
		</function>
			<output>systems/vzor/petal-shift</output>
		</fcs_function>

		<fcs_function name="calculations/vzor/petal-shift-one">
		<function>
			<product>
				<property>systems/vzor/cover-pos</property>
				<value>0.02</value>
			</product>
		</function>
			<output>systems/vzor/petal-shift-one</output>
		</fcs_function>

		<fcs_function name="calculations/vzor/petal-shift-two">
		<function>
			<sum>
				<property>systems/vzor/petal-shift-one</property>
				<property>systems/vzor/petal-shift</property>
			</sum>
		</function>
			<output>systems/vzor/petal-shift-two</output>
		</fcs_function>

		<fcs_function name="calculations/vzor/petal-shift-three">
		<function>
			<sum>
				<property>systems/vzor/petal-shift-one</property>
				<property>systems/vzor/petal-shift</property>
			</sum>
		</function>
			<output>systems/vzor/petal-shift-three</output>
		</fcs_function>

		<fcs_function name="calculations/vzor/petal-shift-four">
		<function>
			<sum>
				<property>systems/vzor/petal-shift-one</property>
				<product>
					<value>2.0</value>
					<property>systems/vzor/petal-shift</property>
				</product>
			</sum>
		</function>
			<output>systems/vzor/petal-shift-four</output>
		</fcs_function>

		<fcs_function name="calculations/vzor/petal-shift-five">
		<function>
			<sum>
				<property>systems/vzor/petal-shift-one</property>
				<product>
					<value>2.0</value>
					<property>systems/vzor/petal-shift</property>
				</product>
			</sum>
		</function>
			<output>systems/vzor/petal-shift-five</output>
		</fcs_function>

		<fcs_function name="calculations/vzor/petal-shift-six">
		<function>
			<sum>
				<property>systems/vzor/petal-shift-one</property>
				<product>
					<value>3.0</value>
					<property>systems/vzor/petal-shift</property>
				</product>
			</sum>
		</function>
			<output>systems/vzor/petal-shift-six</output>
		</fcs_function>

		<fcs_function name="calculations/vzor/petal-shift-seven">
		<function>
			<sum>
				<property>systems/vzor/petal-shift-one</property>
				<product>
					<value>3.0</value>
					<property>systems/vzor/petal-shift</property>
				</product>
			</sum>
		</function>
			<output>systems/vzor/petal-shift-seven</output>
		</fcs_function>

		<fcs_function name="calculations/vzor/petal-shift-eight">
		<function>
			<sum>
				<property>systems/vzor/petal-shift-one</property>
				<product>
					<value>4.0</value>
					<property>systems/vzor/petal-shift</property>
				</product>
			</sum>
		</function>
			<output>systems/vzor/petal-shift-eight</output>
		</fcs_function>

		<switch name="calculations/vzor/cover-not-allowed">
			<default value="systems/vzor/cover-input"/>
			<test logic="AND" value="systems/vzor/cover-command">
				systems/vzor/serviceable eq 0

			</test>
			<output>systems/vzor/cover-input</output>
		</switch>

		<switch name="calculations/vzor/cover-switch">
			<default value="systems/vzor/cover-switch"/>
			<test logic="AND" value="1">
				systems/vzor/cover-pos ge 0.5
			</test>
			<test logic="AND" value="0">
				systems/vzor/cover-pos lt 0.5
			</test>
			<output>systems/vzor/cover-switch</output>
		</switch>

		<switch name="calculations/vzor/light-red">
			<default value="0"/>
			<test logic="AND" value="systems/vzor/light">
				systems/vzor/light gt systems/light/cabine/red
			</test>
			<test logic="AND" value="systems/light/cabine/red">
				systems/vzor/light le systems/light/cabine/red
			</test>
			<output>systems/vzor/light-red</output>
		</switch>

		<switch name="calculations/vzor/light-green">
			<default value="0"/>
			<test logic="AND" value="systems/vzor/light">
				systems/vzor/light gt systems/light/cabine/green
			</test>
			<test logic="AND" value="systems/light/cabine/green">
				systems/vzor/light le systems/light/cabine/green
			</test>
			<output>systems/vzor/light-green</output>
		</switch>

		<switch name="calculations/vzor/light-blue">
			<default value="0"/>
			<test logic="AND" value="systems/vzor/light">
				systems/vzor/light gt systems/light/cabine/blue
			</test>
			<test logic="AND" value="systems/light/cabine/blue">
				systems/vzor/light le systems/light/cabine/blue
			</test>
			<output>systems/vzor/light-blue</output>
		</switch>

		<fcs_function name="calculations/vzor/left-light">
		<function>
			<product>
				<table>
					<independentVar lookup="row">systems/spacecraft/ground-contact</independentVar>
					<tableData>
						0.0		1.0
						1.0		0.0
					</tableData>
				</table>
				<table>
					<independentVar lookup="row">velocities/r-aero-rad_sec</independentVar>
					<independentVar lookup="column">systems/leftswitchpanel/lightcheck-switch</independentVar>
					<tableData>
								0.0		1.0
						-0.001		1.0		1.0
						0.0		0.0		1.0
						1.0		0.0		1.0
					</tableData>
				</table>
			</product>
		</function>
			<output>systems/vzor/left-light</output>
		</fcs_function>

		<fcs_function name="calculations/vzor/right-light">
		<function>
			<product>
				<table>
					<independentVar lookup="row">systems/spacecraft/ground-contact</independentVar>
					<tableData>
						0.0		1.0
						1.0		0.0
					</tableData>
				</table>
				<table>
					<independentVar lookup="row">velocities/r-aero-rad_sec</independentVar>
					<independentVar lookup="column">systems/leftswitchpanel/lightcheck-switch</independentVar>
					<tableData>
								0.0	1.0
						-1.0		0.0	1.0
						0.0		0.0	1.0
						0.001		1.0	1.0
					</tableData>
				</table>
			</product>
		</function>
			<output>systems/vzor/right-light</output>
		</fcs_function>

		<fcs_function name="calculations/vzor/up-light">
		<function>
			<product>
				<table>
					<independentVar lookup="row">systems/spacecraft/ground-contact</independentVar>
					<tableData>
						0.0		1.0
						1.0		0.0
					</tableData>
				</table>
				<table>
					<independentVar lookup="row">velocities/q-aero-rad_sec</independentVar>
					<independentVar lookup="column">systems/leftswitchpanel/lightcheck-switch</independentVar>
					<tableData>
								0.0		1.0
						-0.001		1.0		1.0
						0.0		0.0		1.0
						1.0		0.0		1.0
					</tableData>
				</table>
			</product>
		</function>
			<output>systems/vzor/up-light</output>
		</fcs_function>

		<fcs_function name="calculations/vzor/down-light">
		<function>
			<product>
				<table>
					<independentVar lookup="row">systems/spacecraft/ground-contact</independentVar>
					<tableData>
						0.0		1.0
						1.0		0.0
					</tableData>
				</table>
				<table>
					<independentVar lookup="row">velocities/q-aero-rad_sec</independentVar>
					<independentVar lookup="column">systems/leftswitchpanel/lightcheck-switch</independentVar>
					<tableData>
								0.0	1.0
						-1.0		0.0	1.0
						0.0		0.0	1.0
						0.001		1.0	1.0
					</tableData>
				</table>
			</product>
		</function>
			<output>systems/vzor/down-light</output>
		</fcs_function>

		<fcs_function name="calculations/vzor/up-left-light">
		<function>
			<product>
				<table>
					<independentVar lookup="row">systems/spacecraft/ground-contact</independentVar>
					<tableData>
						0.0		1.0
						1.0		0.0
					</tableData>
				</table>
				<table>
					<independentVar lookup="row">velocities/p-aero-rad_sec</independentVar>
					<independentVar lookup="column">systems/leftswitchpanel/lightcheck-switch</independentVar>
					<tableData>
								0.0		1.0
						-0.001		1.0		1.0
						0.0		0.0		1.0
						1.0		0.0		1.0
					</tableData>
				</table>
			</product>
		</function>
			<output>systems/vzor/up-left-light</output>
		</fcs_function>

		<fcs_function name="calculations/vzor/up-right-light">
		<function>
			<product>
				<table>
					<independentVar lookup="row">systems/spacecraft/ground-contact</independentVar>
					<tableData>
						0.0		1.0
						1.0		0.0
					</tableData>
				</table>
				<table>
					<independentVar lookup="row">velocities/p-aero-rad_sec</independentVar>
					<independentVar lookup="column">systems/leftswitchpanel/lightcheck-switch</independentVar>
					<tableData>
								0.0	1.0
						-1.0		0.0	1.0
						0.0		0.0	1.0
						0.001		1.0	1.0
					</tableData>
				</table>
			</product>
		</function>
			<output>systems/vzor/up-right-light</output>
		</fcs_function>

	</channel>

</system>
